# shortest-path-problem / 最短経路問題

### demo app of shortest path problem using Dijkstra's algorithm with A* algorithm &amp; traveling salesman problem　using genetic algorithm

### ダイクストラアルゴリズムとA*アルゴリズムを用いた最短経路問題と遺伝的アルゴリズムを用いた巡回セールスマン問題のデモアプリ

<img width="500" alt="A* algorithm" src="https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/cdf18f8f-aa4d-4d30-8f29-4322f9a049db">
<img width="500" alt="salesman2" src="https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/f1b6905f-c12e-40cb-b21a-ca91ede34292">

## 【概要】
jupyter nodebookで動作するGUIのアプリ上で、ダイクストラアルゴリズムとA*アルゴリズムによる2地点間の最短経路探索や、遺伝的アルゴリズムによる複数地点の巡回経路探索を実行することができる。  
地図データは、オープンソースとして公開されている、某地区の道路のリンク・ノードCSVデータを少し加工したものである。  

## 【最短経路問題と巡回セールスマン問題】

### 最短経路問題 (Shortest Path Problem)
`概要`：与えられた重み付きグラフにおいて、2つのノード（始点と終点）間の最短の経路（最小の重みの合計）を見つける問題。  
`応用`: 都市間の最短経路、ネットワークルーティング、地図のナビゲーションなど。  
`主なアルゴリズム`: ダイクストラアルゴリズム、ベルマンフォードアルゴリズムなど。  

### 巡回セールスマン問題 (Traveling Salesman Problem: TSP)
`概要`：与えられた行き先地点のリストと各2地点間の距離が与えられたとき、すべての地点をちょうど1回ずつ訪れ、最初の地点に戻る最短の組み合わせ経路（最小の距離の合計）を見つける最適化問題。  
行き先地点が増えると、その組み合わせは膨大となるため、最も良い最適解を見つけようとする厳密解法では、現実的な時間で求めることが難しくなる。  
そのため、必ずしも最適解ではないものの、近似解と呼ばれる精度がある程度よい解を出力する近似解法や、ある程度良い解が期待される発見的解法が用いられる。  
`応用`: 物流、配送ルートの最適化、製造プロセスのスケジューリングなど。  
`主なアルゴリズム`: 動的計画法、局所探索法、焼きなまし法、遺伝的アルゴリズムなど。

## 【ダイクストラアルゴリズムとは？】
重み付きグラフにおける単一始点最短経路問題を解くためのアルゴリズム。  
与えられたノード（頂点）を始点として、そのノードからの最短経路を計算する。 
  
アルゴリズムの基本的な手順は以下の通り：  
```
1. 開始ノードを設定する。
2. すべてのノードの最短経路の予想値を無限大に設定し、開始ノードの予想値を0にする。
3. 未訪問のノードの中で、最短経路の予想値が最も小さいノードを選ぶ。
4. そのノードからの各隣接ノードへの距離を計算し、現在の予想値よりも小さい場合は更新する。
5. そのノードを「訪問済み」とマークする。
6. すべてのノードが「訪問済み」となるまで、手順3-5を繰り返す。
```
![ダイクストラアルゴリズム図解](https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/2585fd7f-9131-4e4e-ab98-f59843ef46da)

## 【A*（エースター）アルゴリズムとは】
最短経路問題を解くための探索アルゴリズムの1つで、ダイクストラアルゴリズムと違い、Aアルゴリズムではヒューリスティック関数を使用する。  
基本的にはダイクストラ同様、始点ノードから順番に隣接ノードを探索していくが、このヒューリスティック関数によって、目的地に近づくための方向性を持った探索が可能となり、効率的に経路を見つけることができる。  
```
  ※ヒューリスティック関数：  
    問題解決のための推定や予測を提供する関数。特に探索問題や最適化問題において、
    現在の状態から目的状態までのコストや距離を推定するために使用され、
    2次元グリッド上の経路探索では、ユークリッド距離(2点間の直線距離)や、
    マンハッタン距離(碁盤の目状に目的地に向かう際の縦と横の距離の合計)がよく使用される。
```
  
A*アルゴリズムの基本的な手順は以下の通り：
```
1. 開始ノードと目的地ノードを設定する。
2. 各ノードには、以下の2つの値を持たせる。
　・g(n)：開始ノードからノードnまでのコスト。
　・h(n)：ノードnから目的地ノードまでのヒューリスティックに基づく推定コスト。
3. f(n) = g(n) + h(n) を計算し、この値に基づいて最も有望なノードを選択する。
4. 選択したノードが目的地ノードであれば、探索を終了する。
5. そうでない場合、選択したノードの隣接ノードの g と h の値を更新し、f(n) の値も更新する。
6. 未探索のノードの中から、f(n) の値が最小のノードを選択して、手順4-5を繰り返す。
```

## 【遺伝的アルゴリズムとは】
生物の進化のメカニズムを模倣した最適化アルゴリズムの一つで、大規模かつ複雑な探索空間を持つ問題や、伝統的な手法では効果的に解けない問題に対して、近似的な解を求めるために使用される。

遺伝的アルゴリズムの基本的な手順は以下の通り：
```
1. 初期化：適当な解の集団（個体群）をランダムに生成する。
2. 選択：現在の個体群から、ある評価関数（適応度関数）に基づいて良い解（個体）を選ぶ。
3. 交叉（クロスオーバー）：選択された解同士を組み合わせて、新しい解を生成する。このプロセスは、生物の交配を模している。
4. 突然変異：ある確率で、新しい解の一部をランダムに変更する。これは、生物の突然変異を模している。
5. 評価：新しく生成された解の適応度を評価する。
6. 終了条件の確認：終了条件（例：最大世代数、十分な適応度の達成など）が満たされているか確認する。満たされていなければ、再び選択ステップに戻る。
7. 結果の取得：最も適応度の高い解、または特定の条件を満たす解を結果として取得する。
```

## 【使い方】

### [デモアプリの実行]

shortest-path-problem.ipynbを最初から最後のセルまで順番に全て実行すると、アプリが立ち上がる。  
「`拡大`」「`縮小`」ボタンで地図表示の拡大率を変更できる。
<img width="1000" alt="初期画面" src="https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/a936c5f8-1d4d-4f0d-bd66-ac36c9d00a94">  

### [2地点間の最短経路探索]

#### 1. スタート地点とゴール地点の設定。
`ノードの選択`：地図の任意の箇所をダブルクリックすると、最近傍のノードが選択され、青色で表示される。  
`スタート地点の設定`：任意のノードを選択した状態で、「`スタート地点を設定`」ボタンをクリックすると、選択ノードがスタート地点に設定され、水色で表示される。  
<img width="500" alt="ノード選択1" src="https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/75dcdc62-7b57-4dda-b375-eecd68591eff">
<img width="500" alt="スタート設定" src="https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/880646db-a545-42f5-90c7-ba429213e8df">  
`ノードの選択`：地図の任意の箇所をダブルクリックすると、最近傍のノードが選択され、青色で表示される。  
`ゴール地点の設定`：任意のノードを選択した状態で、「`ゴール地点を設定`」ボタンをクリックすると、選択ノードがスタート地点に設定され、桃色で表示される。  
<img width="500" alt="ノード設定2" src="https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/3df302a0-38d0-4cac-82e2-2744b07084cb">
<img width="500" alt="ゴール設定" src="https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/0c88138a-6586-4a8e-b8b4-ce1829f0e0fa">  
`（おまけ）ランダムにスタート地点とゴール地点を設定`：「`ランダムで２地点を設定`」ボタンをクリックすると、ランダムなノードがスタート地点とゴール地点を設定される。  

#### 2. 最短経路探索の実行。
`デフォルトの実行`：スタート地点とゴール地点を設定した状態で、「`２地点の最短距離を算出`」ボタンをクリックすると、最短経路が橙色で表示され、右下に最短距離、探索ノード数、実行時間が表示される。  
<img width="500" alt="デフォルト最短経路" src="https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/17b7723c-419e-40b9-ab4c-7afecd8c9746">  
`A*アルゴリズムの使用`：「`A*アルゴリズムを使用`」チェックボックス選択状態ではA*アルゴリズムを使用し、選択解除すると通常のダイクストラアルゴリズムを使用する。  
`探索済みリンクの描画`：「`探索済みリンクの描画`」チェックボックス選択状態で、「`２地点の最短距離を算出`」ボタンをクリックすると、最短経路確定までに探索したリンクが全て橙色で表示される。  
<img width="500" alt="Dijkstra's algorithm" src="https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/8695def4-99ca-4a38-8687-3e82a3dec930">
<img width="500" alt="A* algorithm" src="https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/617a6f4b-2670-46dd-9929-756cf3ffabf4">  

通常のダイクストラアルゴリズムでは、始点から同心円状に探索を進めるため、探索範囲が広くなり、探索ノード数と実行時間が長くなっているが、A*アルゴリズムを使用した場合は、始点から目的地の方角に探索を進めていくため、探索範囲が絞られ、探索ノード数と実行時間が短くなっていることが分かる。  

### [複数地点の巡回経路探索]

#### 1. 巡回地点の設定
`巡回地点の設定`：「`ランダムで巡回地点を設定`」ボタンをクリックすると、ランダムな10地点が巡回地点に設定され、黄色で表示される。  
<img width="500" alt="巡回地点設定" src="https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/846e7807-14e6-4463-84da-52a2503cc289">

#### 2. 距離行列の算出
`距離行列の算出`：スタート地点とゴール地点、巡回地点を設定した状態で、「`距離行列を算出`」ボタンをクリックすると、遺伝的アルゴリズム実行に必要な、各2点間の距離行列が内部で算出され、巡回地点が橙色で表示される。  
<img width="500" alt="距離行列算出" src="https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/e73c1680-783d-436a-a0d4-d8e1f5299b53">  

#### 3. 遺伝的アルゴリズム実行
`遺伝的アルゴリズムの実行`：距離行列を算出した状態で、「`遺伝的アルゴリズム - 実行`」ボタンをクリックすると、100世代まで実行した時の最短経路と訪問順が描画され、右下に最短距離が更新された世代の結果が表示される。  
`巡回オプションの選択`：「`循環ルートを検索`」チェックボックス選択状態ではスタート地点から10地点訪問してまたスタート地点に戻ってくる循環経路が探索され、選択解除するとスタート地点から10地点訪問してゴール地点に向かう経路が探索される。  
<img width="500" alt="遺伝的アルゴリズム" src="https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/dc1b4f4c-e168-46ab-a64f-3a2465c54303">  
※この経路は最善ではあるが必ずしも最適ではなく、遺伝的アルゴリズムの乱数性により、毎回結果が変わる可能性がある。

`10回連続で遺伝的アルゴリズムの実行`：距離行列を算出した状態で、「`10連続で実行`」ボタンをクリックすると、100世代までの遺伝的アルゴリズムを10回連続で実行した際の最短距離経路が描画され、右下に各回における最短距離が右下に表示される。  
<img width="500" alt="10回通常" src="https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/fcf57ea5-a909-4fb0-ada6-a12aee33222c">
<img width="500" alt="10回循環" src="https://github.com/sumomoyuri/shortest-path-problem/assets/116475757/26f1399a-4600-4e0c-a3d4-c6860ace36fc">  
1回ごとに結果が異なっており、必ずしも最適解ではないことが分かる。
